(function(){function f(a){a=a||"unknown error";this.toString=function(){return"ThreadError: "+a}}function h(){var a="group#"+(new Date).valueOf();this.id=function(){return a};this.add=function(b){if(!(b instanceof c))throw new f("could not add thread, passed argument is not a thread");g[b.id]||(g[b.id]=b);e[b.id]=a};this.remove=function(a){if(!(a instanceof c))throw new f("could not remove thread, passed argument is not a thread");e[a.id]=h.Default.id};this.has=function(b){if(!(b instanceof c))throw new f("could not check thread, passed argument is not a thread");
return e[b.id]===a};this.length=function(){var b,c=0;for(b in e)e[b]===a&&++c;return c};this.kill=function(){for(var b in e)e[b]===a&&g[b].kill()};this.send=function(b,c){for(var d in e)e[d]===a&&g[d].send(b,c)};Object.defineProperties(this,{id:{get:this.id},length:{get:this.length}})}function c(a){var b=this,g="thread#"+(new Date).valueOf();if(!c.isSupported)throw new f("could not create thread, not all necessary dependencies are defined");if("function"===typeof a||a instanceof HTMLScriptElement){a=
("function"===typeof a?a.toString():a.textContent).match(/^function\s*\([^\)]*\)\s*\{\s*((\S|\s)*\S)\s*\}$/);if(null==a||""===a[1])throw new f("could not create thread, script does not contain any commands or has an invalid structure");a=['this.addEventListener( "message", function ( e ) {\n\t',"var ret = ("+a[0]+").call( e.target, e.data );","\n\tthis.postMessage( ret );\n}, false);"].join("");var l=d.URL.createObjectURL(new Blob([a],{type:"application/javascript"}))}else if("string"===typeof a){a=
a.match(/\S+/);if(!a)throw new f("could not create thread, passed argument does not contain any file name");l=a[0]}else throw new f("could not create thread, passed argument is neither a function nor a script element nor a file uri");var j=new Worker(l),k=1;h.Default.add(this);j.addEventListener("error",function(a){b.kill();k=3;throw new f("thread terminated in "+a.filename+" on line "+a.lineno+" with the following message: "+a.message);},!1);this.send=function(a,c){if(1!==k)return!1;"function"===
typeof c&&j.addEventListener("message",function(a){c.call(b,a.data);j.removeEventListener(this)},!1);j.postMessage(a)};this.status=function(){return k};this.id=function(){return g};this.kill=function(){if(1!==k)return null;j.terminate();d.URL.revokeObjectURL(l);k=2;return!0};Object.defineProperties(this,{status:{get:this.status},running:{get:function(){return 1===this.status}},terminated:{get:function(){return 1!==this.status}},id:{get:this.id},group_id:{get:function(){return e[this.id]}}})}var d=
window,e={},g={};h.Default=new h;c.RUNNING=1;c.TERMINATED=2;c.ERROR=3;c.kill=function(a){return a instanceof c?a.kill():!1};c.isSupported=!(!d.URL||!d.URL.createObjectURL||!d.URL.revokeObjectURL||!d.Blob||!d.Worker);d.Thread=c;d.ThreadError=f;d.ThreadGroup=h})();
