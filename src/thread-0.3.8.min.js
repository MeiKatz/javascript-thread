(function(){"use strict";function p(a,b){var c=a.split("/"),e=[],d;for(d=0;d<c.length;++d)".."===c[d]?e.pop():"."!==c[d]&&e.push(c[d]);a=e.join("/").replace(/^[\/]+/,"");return null==b?"/"+a:b+"/"+a}function r(a){var b=[],c;a.replace(/("(\\\\|\\"|[^"])*")|('(\\\\|\\'|[^'])*')|(\/(\\\\|\\\/|[^\/])+\/[ig]*)|([^"'\/]*)/g,function(a,c,d,f,h,k,g,q){if(null!=q)return q.replace(/((return|var|case|delete|typeof|void|function|else)[ \r\n\t]+)|([ \r\n\t]+(instanceof|in)[ \r\n\t]+)|([ \r\n\t]+)|(;[ \n\r\t]*\})|(true|false)|(.)/g,
function(a,c,d,e,f,h,k,g,l){d?b.push(d+" "):f?b.push(" "+f+" "):k?b.push((b.pop()||"")+"}"):g?b.push((b.pop()||"")+("true"===g?"!0":"!1")):l&&b.push((b.pop()||"")+l)});b.push((b.pop()||"")+a)});for(c in b)b[c]=b[c].replace(/^(return|function|case|void) ([^a-zA-Z0-9_])/g,"$1$2");return b.join("")}function f(a){this.message=a||"unknown error"}function k(a){this.__props__={};this.__props__.group_id="group#"+(new Date).valueOf();null!=a&&this.add(a)}function d(a,b){this.__props__={};if(!d.isSupported)throw new f("could not create thread, not all necessary dependencies are defined");
b="function"===typeof a?a:b;a=a instanceof Array?a:[];a.push(p);this.__props__.thread_id="thread#"+(new Date).valueOf();this.__props__.callback=b;if("function"!==typeof b)throw new f("could not create thread, passed argument is not a function");var c=b.toString();if(!c.substring(c.indexOf("{")+1,c.lastIndexOf("}")).replace(/[\t\n\r ]/,""))throw new f("could not create thread, script does not contain any commands");var e=h.location,g={hash:e.hash,host:e.host,hostname:e.hostname,href:e.href,pathname:e.pathname,
port:e.port,protocol:e.protocol,search:e.search,thread_id:this.__props__.thread_id,code:c,import_files:"",import_functions:""};if(0<a.length){var c=[],n=[],l;for(l in a)if(e=a[l],"string"===typeof e)n.push(p(e,h.location.protocol+"//"+h.location.host));else if("function"===typeof e&&/^function[ ]+\w+/.test(e.toString()))e=e.toString(),c.push(e);else throw new f("could not load required script or function, one of the passed values is neither a string nor a named function");0<c.length&&(g.import_functions=
c.join("\r\n")+"\r\n");0<n.length&&(g.import_files='importScripts("'+n.join('","')+'");\r\n')}c=function(){return"("+function(){__import_files;__import_functions;this.location=new function(){this.hash="__hash";this.host="__host";this.hostname="__hostname";this.href="__href";this.pathname="__pathname";this.port="__port";this.protocol="__protocol";this.search="__search"};this.addEventListener("message",function(a){var b=a.target,c=this;b.send=function(a){c.postMessage([2,a])};b.require=function(a){a=
"string"===typeof a?[a]:a;a=a instanceof Array?a:[];if(0!==a.length){for(var b in a)n[b]=p(a[b],"__protocol//__host");c.importScripts.apply(this,a)}};b.threadId="__thread_id";a=__code.call(b,a.data);this.postMessage([1,a])},!1)}.toString().replace(/__([a-zA-Z0-9_]+)/g,function(a,b){return g[b]})+").call( self );"}();l=h.URL.createObjectURL(new Blob([r(c)],{type:"application/javascript"}));this.__props__.worker=new Worker(l);this.__props__.url=l;this.__props__.status=2;k.Default.add(this);var m=this;
this.__props__.worker.addEventListener("error",function(a){m.kill();m.__props__.status=4;throw new f("thread terminated in "+a.filename+" on line "+a.lineno+" with the following message: "+a.message);},!1)}f.prototype.toString=function(){return"ThreadError: "+this.message};var h=window,g={},m={};k.prototype={each:function(a){if("function"!==typeof a)throw new f("could not iterate over threads, passed argument is not a function");for(var b in g)g[b]===this.__props__.group_id&&a.call(m[b],b,m[b])},
add:function(a){if(a instanceof Array&&0<a.length){for(var b in a)this.add(a[b]);return!0}if(!(a instanceof d))throw new f("could not add thread, passed argument is not a thread");m[a.id]||(m[a.id]=a);g[a.id]=this.__props__.group_id;return!0},remove:function(a){if(a instanceof Array&&0<a.length){for(var b in a)this.remove(a[b]);return!0}if(!(a instanceof d))throw new f("could not remove thread, passed argument is not a thread");g[a.id]=k.Default.id;return!0},has:function(a){if(a instanceof Array&&
0<a.length){for(var b in a)if(!this.has(a[b]))return!1;return!0}if(!(a instanceof d))throw new f("could not check thread, passed argument is not a thread");return g[a.id]===this.__props__.group_id},kill:function(){this.each(function(){this.kill()});return!0},stop:function(){this.each(function(){this.stop()});return!0},send:function(a,b,c){this.each(function(){this.send(a,b,c)})},filter:function(a){a=a||function(){return 3>this.status};var b=[];this.each(function(c){a.call(this,c,this)||(k.Default.add(this),
b.push(this))});return b},toString:function(){return"[object ThreadGroup]"},valueOf:function(){var a=[];this.each(function(){a.push(this)});return a}};Object.defineProperties(k.prototype,{id:{get:function(){return this.__props__.group_id}},length:{get:function(){var a,b=0;for(a in g)g[a]===this.__props__.group_id&&++b;return b}},threads:{get:function(){for(var a in g);}}});k.Default=new k;k.Default.remove=function(){throw new f("you cannot remove anything from the default thread group");};d.prototype=
{send:function(a,b,c){if(2<this.__props__.status)return!1;"function"===typeof a&&(c=b,b=a,a=void 0);this.__props__.status=1;var d=this,f=this.__props__.worker;if("function"===typeof b){c=null==c?b:c;var g=function(a){1===a.data[0]?(d.__props__.status=2,c.call(d,a.data[1],2),f.removeEventListener("message",g,!1)):b.call(d,a.data[1],1)};f.addEventListener("message",g,!1)}f.postMessage(a)},stop:function(){if(1!==this.__props__.status)return null;var a=this;this.__props__.status=2;this.__props__.worker.terminate();
this.__props__.worker=new Worker(this.__props__.url);this.__props__.worker.addEventListener("error",function(b){a.kill();a.__props__.status=4;throw new f("thread terminated in "+b.filename+" on line "+b.lineno+" with the following message: "+b.message);},!1);return!0},kill:function(){if(2<this.__props__.status)return null;this.__props__.worker.terminate();h.URL.revokeObjectURL(this.__props__.url);this.__props__.status=3;return!0},toString:function(){return"[object Thread]"},valueOf:function(){return this.__props__.callback}};
Object.defineProperties(d.prototype,{status:{get:function(){return this.__props__.status}},running:{get:function(){return 1===this.__props__.status}},waiting:{get:function(){return 2===this.__props__.status}},terminated:{get:function(){return 2<this.__props__.status}},id:{get:function(){return this.__props__.thread_id}},group_id:{get:function(){return g[this.__props__.thread_id]}}});d.RUNNING=1;d.WAITING=2;d.TERMINATED=3;d.ERROR=4;d.version="0.3.8";d.kill=function(a){return a instanceof d||a instanceof
k?a.kill():!1};d.stop=function(a){return a instanceof d||a instanceof k?a.stop():!1};d.isSupported=!!(h.URL&&h.URL.createObjectURL&&h.URL.revokeObjectURL&&h.Blob&&h.Worker);h.Thread=d;h.ThreadError=f;h.ThreadGroup=k})();
