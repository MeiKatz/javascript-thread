(function(){"use strict";function f(a){a=a||"unknown error";this.toString=function(){return"ThreadError: "+a}}function g(a){this.__props__={};this.__props__.group_id="group#"+(new Date).valueOf();null!=a&&this.add(a)}function d(a,b){this.__props__={};if(!d.isSupported)throw new f("could not create thread, not all necessary dependencies are defined");b="function"===typeof a?a:b;a=a instanceof Array?a:[];this.__props__.thread_id="thread#"+(new Date).valueOf();this.__props__.callback=b;if("function"!==typeof b)throw new f("could not create thread, passed argument is not a function");
var c=b.toString();if(0===c.substring(c.indexOf("{")+1,c.lastIndexOf("}")).replace(/[\t\n\r ]/,"").length)throw new f("could not create thread, script does not contain any commands");c=['this.addEventListener("message",function(e){var t=e.target,s=this;delete t.onmessage; delete t.onerror; delete t.self;t.send=function(d){s.postMessage([!1,d])};t.threadId="',this.__props__.thread_id,'";',"var r=("+c+").call(t,e.data);","this.postMessage([!0,r]);},false);"].join("");0<a.length&&(c='importScripts("'+
a.join('","')+'");'+c);c=h.URL.createObjectURL(new Blob([c],{type:"application/javascript"}));this.__props__.worker=new Worker(c);this.__props__.url=c;this.__props__.status=2;g.Default.add(this);var e=this;this.__props__.worker.addEventListener("error",function(a){e.kill();e.__props__.status=4;throw new f("thread terminated in "+a.filename+" on line "+a.lineno+" with the following message: "+a.message);},!1)}var h=window,e={},k={};g.prototype={each:function(a){if("function"!==typeof a)throw new f("could not iterate over threads, passed argument is not a function");
for(var b in e)e[b]===this.__props__.group_id&&a.call(k[b],b,k[b])},add:function(a){if(a instanceof Array&&0<a.length){for(var b in a)this.add(a[b]);return!0}if(!(a instanceof d))throw new f("could not add thread, passed argument is not a thread");k[a.id]||(k[a.id]=a);e[a.id]=this.__props__.group_id;return!0},remove:function(a){if(a instanceof Array&&0<a.length){for(var b in a)this.remove(a[b]);return!0}if(!(a instanceof d))throw new f("could not remove thread, passed argument is not a thread");e[a.id]=
g.Default.id;return!0},has:function(a){if(a instanceof Array&&0<a.length){for(var b in a)if(!this.has(a[b]))return!1;return!0}if(!(a instanceof d))throw new f("could not check thread, passed argument is not a thread");return e[a.id]===this.__props__.group_id},kill:function(){this.each(function(){this.kill()})},stop:function(){this.each(function(){this.stop()})},send:function(a,b,c){this.each(function(){this.send(a,b,c)})},filter:function(a){a=a||function(){return 3>this.status};var b=[];this.each(function(c){a.call(this,
c,this)||(g.Default.add(this),b.push(this))});return b},toString:function(){return"[object ThreadGroup]"},valueOf:function(){var a=[];this.each(function(){a.push(this)});return a}};Object.defineProperties(g.prototype,{id:{get:function(){return this.__props__.group_id}},length:{get:function(){var a,b=0;for(a in e)e[a]===this.__props__.group_id&&++b;return b}},threads:{get:function(){for(var a in e);}}});g.Default=new g;g.Default.remove=function(){throw new f("you cannot remove anything from the default thread group");
};d.prototype={send:function(a,b,c){if(2<this.__props__.status)return!1;this.__props__.status=1;var d=this,e=this.__props__.worker;if("function"===typeof b){c=null==c?b:c;var f=function(a){a.data[0]?(d.__props__.status=2,c.call(d,a.data[1],2),e.removeEventListener("message",f,!1)):b.call(d,a.data[1],1)};e.addEventListener("message",f,!1)}e.postMessage(a)},stop:function(){if(1===this.__props__.status){var a=this;this.__props__.status=2;this.__props__.worker.terminate();this.__props__.worker=new Worker(this.__props__.url);
this.__props__.worker.addEventListener("error",function(b){a.kill();a.__props__.status=4;throw new f("thread terminated in "+b.filename+" on line "+b.lineno+" with the following message: "+b.message);},!1)}},kill:function(){if(2<this.__props__.status)return null;this.__props__.worker.terminate();h.URL.revokeObjectURL(this.__props__.url);this.__props__.status=3;return!0},toString:function(){return"[object Thread]"},valueOf:function(){return this.__props__.callback}};Object.defineProperties(d.prototype,
{status:{get:function(){return this.__props__.status}},running:{get:function(){return 1===this.__props__.status}},waiting:{get:function(){return 2===this.__props__.status}},terminated:{get:function(){return 2<this.__props__.status}},id:{get:function(){return this.__props__.thread_id}},group_id:{get:function(){return e[this.__props__.thread_id]}}});d.RUNNING=1;d.WAITING=2;d.TERMINATED=3;d.ERROR=4;d.version="0.3.5";d.kill=function(a){return a instanceof d||a instanceof g?a.kill():!1};d.isSupported=
!!(h.URL&&h.URL.createObjectURL&&h.URL.revokeObjectURL&&h.Blob&&h.Worker);h.Thread=d;h.ThreadError=f;h.ThreadGroup=g})();
