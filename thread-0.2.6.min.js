(function(){function f(a){a=a||"unknown error";this.toString=function(){return"ThreadError: "+a}}function g(a){this.__props__.group_id="group#"+(new Date).valueOf();null!=a&&this.add(a)}function b(a){if(!b.isSupported)throw new f("could not create thread, not all necessary dependencies are defined");this.__props__.thread_id="thread#"+(new Date).valueOf();if("function"===typeof a||a instanceof HTMLScriptElement){a=("function"===typeof a?a.toString():a.textContent).match(/^function\s*\([^\)]*\)\s*\{\s*((\S|\s)*\S)\s*\}$/);
if(null==a||""===a[1])throw new f("could not create thread, script does not contain any commands or has an invalid structure");a=['this.addEventListener( "message", function ( e ) {\n\t',"var ret = ("+a[0]+").call( e.target, e.data );","\n\tthis.postMessage( ret );\n}, false);"].join("");a=e.URL.createObjectURL(new Blob([a],{type:"application/javascript"}))}else if("string"===typeof a){a=a.match(/\S+/);if(!a)throw new f("could not create thread, passed argument does not contain any file name");a=
a[0]}else throw new f("could not create thread, passed argument is neither a function nor a script element nor a file uri");this.__props__.worker=new Worker(a);this.__props__.status=1;g.Default.add(this);var c=this;this.__props__.worker.addEventListener("error",function(a){c.kill();c.__props__.status=3;throw new f("thread terminated in "+a.filename+" on line "+a.lineno+" with the following message: "+a.message);},!1)}var e=window,d={},h={};g.prototype={__props__:{},add:function(a){if(a instanceof
Array&&0<a.length){for(var c in a)this.add(a[c]);return!0}if(!(a instanceof b))throw new f("could not add thread, passed argument is not a thread");h[a.id]&&(h[a.id]=a);d[a.id]=this.__props__.group_id;return!0},remove:function(a){if(a instanceof Array&&0<a.length){for(var c in a)this.remove(a[c]);return!0}if(!(a instanceof b))throw new f("could not remove thread, passed argument is not a thread");d[a.id]=g.Default.id;return!0},has:function(a){if(a instanceof Array&&0<a.length){for(var c in a)if(!this.has(a[c]))return!1;
return!0}if(!(a instanceof b))throw new f("could not check thread, passed argument is not a thread");return d[a.id]===this.__props__.group_id},kill:function(){for(var a in d)d[a]===this.__props__.group_id&&h[a].kill()},send:function(a,c){for(var b in d)d[b]===this.__props__.group_id&&h[b].send(a,c)},toString:function(){return"[object ThreadGroup]"},valueOf:function(){var a,c=[];for(a in d)d[a]===this.__props__.group_id&&c.push(h[a]);return c}};Object.defineProperties(g.prototype,{id:{get:function(){return this.__props__.group_id}},
length:{get:function(){var a,c=0;for(a in d)d[a]===this.__props__.group_id&&++c;return c}}});g.Default=new g;b.prototype={__props__:{},send:function(a,c){if(1!==this.__props__.status)return!1;var b=this,d=this.__props__.worker;if("function"===typeof c){var e=function(a){c.call(b,a.data);d.removeEventListener("message",e,!1)};d.addEventListener("message",e,!1)}d.postMessage(a)},kill:function(){if(1!==this.__props__.status)return null;this.__props__.worker.terminate();e.URL.revokeObjectURL(url);this.__props__.status=
2;return!0},toString:function(){return"[object Thread]"}};Object.defineProperties(b.prototype,{status:{get:function(){return this.__props__.status}},running:{get:function(){return 1===this.__props__.status}},terminated:{get:function(){return 1!==this.__props__.status}},id:{get:function(){return this.__props__.thread_id}},group_id:{get:function(){return d[this.__props__.thread_id]}}});b.RUNNING=1;b.TERMINATED=2;b.ERROR=3;b.version="0.2.6";b.kill=function(a){return a instanceof b||a instanceof g?a.kill():
!1};b.isSupported=!(!e.URL||!e.URL.createObjectURL||!e.URL.revokeObjectURL||!e.Blob||!e.Worker);e.Thread=b;e.ThreadError=f;e.ThreadGroup=g})();
